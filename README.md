# ACC-sixback
ACC í•´ì»¤í†¤ 1íŒ€ ì‹ìŠ¤ë°±

# í”„ë¡œì íŠ¸ ì†Œê°œ

> ì£¼ì œ: ì´ë©”ì¼ ëŒ€ëŸ‰ ë°œì†¡ ì‹œìŠ¤í…œ ì„¤ê³„
> 

https://github.com/aws-cloud-clubs/ACC-sixback

## ìš”êµ¬ ë° ì œì•½ ì‚¬í•­

> ëŒ€ëŸ‰ì˜ ì´ë©”ì¼ì„ ì ì • ì§€ì—° ì‹œê°„ ì•ˆì— ë°œì†¡í•˜ê¸° ìœ„í•´ í™•ì¥ì„±ì„ ê³ ë ¤í•œ ì•„í‚¤í…ì²˜ ì„¤ê³„ê°€ í•„ìš”í•˜ë‹¤.
> 
- ì´ë©”ì¼ì˜ í¬ê¸°ëŠ” í‰ê·  `100KB`ë¡œ ê°€ì •í•œë‹¤.
- ì´ë©”ì¼ì€ ë¹„ì¦ˆë‹ˆìŠ¤ì˜ ì„±ê²©ì— ë”°ë¼ ë°œì†¡ íŒ¨í„´ì´ ê°ê¸° ë‹¤ë¥´ë‹¤.
    - 1,000ê°œì˜ ë©”ì¼ì„ 5ë¶„ ì´ë‚´ì— ë°œì†¡í•œë‹¤. **â† ëŒ€íšŒ ìµœì†Œ ìš”êµ¬ ì‚¬í•­**
    - 30,000ê°œì˜ ë©”ì¼ì„ 5ë¶„ ì´ë‚´ì— ë°œì†¡í•œë‹¤.
    - 1,000,000ê°œì˜ ë©”ì¼ì„ 5ë¶„ ì´ë‚´ì— ë°œì†¡í•œë‹¤.

> ì‚¬ìš©ìì˜ ë°ì´í„°ì™€ ì„œë¹„ìŠ¤ ì•ˆì •ì„±ì„ ìœ„í•´ ê³ ê°€ìš©ì„± ì„¤ê³„ê°€ í•„ìš”í•˜ë‹¤.
> 
- ì´ë©”ì¼ ë°œì†¡ ê¸°ëŠ¥ì€ ì£¼ìš” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ê´€ë ¨ì´ ì ë‹¤. ë”°ë¼ì„œ ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì²˜ë¡œ ì¸í”„ë¼ ì˜¤ë²„í—¤ë“œì™€ ë¹„ìš©ì„ ì ˆê°í•˜ê³  ìœ ì—°í•˜ê²Œ ëŒ€ëŸ‰ íŠ¸ë˜í”½ì— ëŒ€ì²˜í•œë‹¤.

# ìµœì¢… ì•„í‚¤í…ì²˜
![image](https://github.com/user-attachments/assets/cb47114e-6863-485a-a8de-57c97f1231df)

# ì„œë¹„ìŠ¤ í”Œë¡œìš°

### STEP 0 : ì†¡ì‹ ìê°€ ì´ë©”ì¼ í…œí”Œë¦¿ì„ (ì´ë©”ì¼ ë°œì†¡ ì „ì—) DynamoDBì— ì €ì¥í•œë‹¤.

```json
{
	"template_key" : 3, 
	"template_value" : "
	<!DOCTYPE html>
	<html>
	<head>
	<title>{{mailTitle}}</title>
	</head>
	<body>
    <h1>Welcome, {{recipientName}}!</h1>
    <p>Thank you for joining us. We're excited to have you.</p>
    <p>Please find the details below:</p>
    <p>{{mailContent}}</p>
    <p>Best regards,<br>{{senderName}}</p>
    <div><img src={{image_0}} alt="Image 1" style="width: 300px; height: 300px;" />
    <img src={{image_1}} alt="Image 2" style="width: 300px; height: 300px;" /></div>
	</canvas>
	</body>
	</html>
	"
}
```

### STEP 1: ì†¡ì‹ ìëŠ” ë°œì†¡í•  ë©”ì¼ í…œí”Œë¦¿ì„ ì„ íƒí•œ ë’¤, ë‚´ìš©ì„ ì™„ì„±í•˜ê³  ì´ë©”ì¼ ìˆ˜ì‹ ì ëª©ë¡(.csv)ì„ ì—…ë¡œë“œí•œë‹¤.

![image](https://github.com/user-attachments/assets/c4c90195-209e-4f38-9761-1cb5b91023a5)
![image](https://github.com/user-attachments/assets/093bef6b-083e-47b4-8198-5c9872fc90c8)


### [/api/url]

![image](https://github.com/user-attachments/assets/bf708fa1-431a-4976-aaf3-1055b1940f46)


- `email-urls-lambda`: Presigned URL ìƒì„± ìš”ì²­ í›„ ë°˜í™˜
- Client: Presigned URLì„ í†µí•´ ì´ë¯¸ì§€ ë° ì´ë©”ì¼ ìˆ˜ì‹ ì ëª©ë¡(.csv) íŒŒì¼ ë²„í‚· ì—…ë¡œë“œ
- ì´ëŸ° ë°©ì‹ì„ ì‚¬ìš©í•œ ì´ìœ ëŠ” API Gatewayë¥¼ í†µí•´ ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ì‚½ì…í•˜ë©´ 10MBë¼ëŠ” ì œí•œì— ì˜í•´ ê³ í’ˆì§ˆì˜ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- ë˜í•œ SQSì—ëŠ” ì´ë¯¸ì§€ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ê³  í˜ì´ë¡œë“œê°€ 256kbê¸° ë•Œë¬¸ì—

### STEP 2: ì…ë ¥í•œ ë‚´ìš©ì— ëŒ€í•´ â€˜ì¦‰ì‹œë°œì†¡â€™ OR â€˜ì˜ˆì•½ë°œì†¡â€™

### ì¦‰ì‹œë°œì†¡: [/api/general]

![image](https://github.com/user-attachments/assets/ecdbd757-ebfe-4ee4-bd2e-bc3932653b49)


- Client: jsonì„ ì „ì†¡í•´ `generalinput-lambda` ì‹¤í–‰

```json
{
  "Records": [
    {
      "body": {
        "TemplateID": "template_001",
        "Version": "1",
        "recipientEmail": "luckyrkd@naver.com/emails/9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08.csv",
        "senderEmail": "gmh8257@gmail.com",
        "mailTitle": "Welcome!",
        "recipientName": "SixBackMember!",
        "mailContent": "Thank you for joining us.",
        "senderName": "SixBack",
        "image_0": "https://dev-email-s3-attachment.s3.ap-northeast-2.amazonaws.com/SnedEmailTest001/37a12c3801e61148ca5dc72f0b5049f3.jpg",
        "image_1": "https://dev-email-s3-attachment.s3.ap-northeast-2.amazonaws.com/SnedEmailTest001/5c3519fc9803776ed2bd917a87503954.jpg"
      }
    }
  ]
}
```

- `generalinput-lambda`: recipientEmailì˜ s3 ë§í¬ë¡œ ì ‘ê·¼í•´ ìˆ˜ì‹ ì ì´ë©”ì¼ì´ ì €ì¥ë¼ìˆëŠ” csvíŒŒì¼ì„ ë¶ˆëŸ¬ì˜¨ í›„, ìˆ˜ì‹ ì ëª©ë¡ì—ì„œ ìˆ˜ì‹ ìë¥¼ í•œëª…ì”© ë¶„ë¦¬í•˜ì—¬ dev-email-partition-sqsë¡œ ì „ë‹¬
- `partition-sqs`: dev-email-send-lambda-primary-1ë¡œ ìˆ˜ì‹ ìë³„ ì´ë©”ì¼ ì •ë³´ë¥¼ ì „ë‹¬
- `email-send-lambda`: ì „ë‹¬ ë°›ì€ ìˆ˜ì‹ ìë³„ ì´ë©”ì¼ì„ ê¸°ë°˜ìœ¼ë¡œ DynamoDBì— ì €ì¥ëœ ì´ë©”ì¼ í…œí”Œë¦¿ê³¼ í•©ì³ SESì— ì´ë©”ì¼ ì „ì†¡ì„ ëª…ë ¹
- `SES`: ì´ë©”ì¼ ì „ì†¡

### ì˜ˆì•½ë°œì†¡: [/api/reservation]

![image](https://github.com/user-attachments/assets/c6d6971d-0b82-4867-aa06-8c6f1a0e6f9c)


- Client: jsonì„ ì „ì†¡í•´ `reservationinput-lambda` ì‹¤í–‰

```json
{
  "Records": [
    {
      "body": {
        "TemplateID": "template_001",
        "Version": "1",
        "recipientEmail": "luckyrkd@naver.com/emails/9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08.csv",
        "senderEmail": "gmh8257@gmail.com",
        "mailTitle": "Welcome!",
        "recipientName": "SixBackMember!",
        "mailContent": "Thank you for joining us.",
        "senderName": "SixBack",
        "sendingSchedule": "2024-08-01T23:00:00",
        "image_0": "https://dev-email-s3-attachment.s3.ap-northeast-2.amazonaws.com/SnedEmailTest001/37a12c3801e61148ca5dc72f0b5049f3.jpg",
        "image_1": "https://dev-email-s3-attachment.s3.ap-northeast-2.amazonaws.com/SnedEmailTest001/5c3519fc9803776ed2bd917a87503954.jpg"
      }
    }
  ]
}

```

- `reservationinput-lambda`: sendingScheduleì˜ ì „ì†¡ ì˜ˆì•½ ì‹œê°ì„ ë°”íƒ•ìœ¼ë¡œ eventbridgeì— create scheduleì„ ì§„í–‰, payloadë¡œ sendingScheduleì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ json ë¶€ë¶„ì„ ì „ë‹¬
- eventbridge: ì „ì†¡ ì˜ˆì•½ ì‹œê°ì— `eventtriggered-lambda`ë¡œ  payload ì „ë‹¬
- `reservated-email-sqs`: `dev-email-generalinput-lambda-primary-1`ë¡œ ì „ì†¡ ì˜ˆì•½ ì‹œê°ì„ ì œì™¸í•œ json ì „ì†¡
- **ë‚˜ë¨¸ì§€ ë¶€ë¶„ì€ ì¦‰ì‹œ ë°œì†¡ê³¼ ë™ì¼**

![image](https://github.com/user-attachments/assets/23c317df-cdf0-4c73-9dab-4b0522ca73e2)

reservationinput-lambda-primary-1ì—ì„œ create scheduleì„ í•˜ì—¬ eventbridge scheduleì— í‘œì‹œë˜ëŠ” ëª¨ìŠµ

# **ì•„í‚¤í…ì²˜ ê²€ì¦**

## 1,000ê°œì˜ ë©”ì¼ì„ 5ë¶„ ì´ë‚´ì— ë°œì†¡í•˜ëŠ” ê²½ìš°

![image](https://github.com/user-attachments/assets/54193d3e-660c-4069-989f-0fee56bc60ff)


- ê³µì‹ë¬¸ì„œì— ì˜í•˜ë©´, ê¸°ë³¸ì ìœ¼ë¡œ ëŒë‹¤ í•¨ìˆ˜ì˜ ê° ì‹¤í–‰ í™˜ê²½ì€ ì´ˆë‹¹ 10ê°œê°€ ìµœëŒ€ì´ë‹¤. ë”°ë¼ì„œ ì‹¤í–‰ ì‹œê°„ì´ 100ms ì´í•˜ì¸ ìš”ì²­ì´ 3,000ê°œ ë“¤ì–´ì˜¤ë©´ 300ê°œ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë™ì‹œì„± ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤.
    - ì‹¤ì œ í…ŒìŠ¤íŠ¸ ì‹œ ì´ë©”ì¼ ë°œì†¡ 1ê±´ì„ ë°œì†¡ ì‹œ 500ms ì´í•˜ì˜ ì‹œê°„ì´ ì±…ì •ë˜ì–´ 1ì´ˆì˜ 1ê°œì˜ ëŒë‹¤ê°€ 2ê°œì˜ ë©”ì¼ ë°œì†¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ëŒë‹¤ì˜ ë™ì‹œì„±ì€ 1000ê°œë¡œ 1ì´ˆë‹¹ 2000ê°œì˜ ë©”ì¼ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒí•©ë‹ˆë‹¤.
    - ë”°ë¼ì„œ 5ë¶„ ë‚´ì˜ ë©”ì¼ì˜ ì²˜ë¦¬ëŠ” ê¸°ë³¸ 1000ê°œ ì´ìƒì´ ê°€ëŠ¥í•  ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.

## 30,000ê°œì˜ ë©”ì¼ì„ 5ë¶„ ì´ë‚´ì— ë°œì†¡í•˜ëŠ” ê²½ìš°

![image](https://github.com/user-attachments/assets/8f85aba2-c00a-407b-bccb-23f3bef349df)



## 1,000,000ê°œì˜ ë©”ì¼ì„ 5ë¶„ ì´ë‚´ì— ë°œì†¡í•˜ëŠ” ê²½ìš°

<aside>
ğŸ”¢ ë‹¨ìˆœí•˜ê²Œ ê³„ì‚°í•˜ë©´ ì¸ìŠ¤í„´ìŠ¤ ìµœëŒ€ 1000ê°œ, ì¸ìŠ¤í„´ìŠ¤ í™˜ê²½ ë‹¹ í•¨ìˆ˜ 10ê°œ/ì´ˆ ì‹¤í–‰

â†’ 1ë¶„ì— 60,000ë²ˆ ì‹¤í–‰ ê°€ëŠ¥ 

â‡’ 5ë¶„ì— 300,000ë²ˆ ê°€ëŠ¥ 

</aside>

- ë”°ë¼ì„œ 1,000,000ê°œì˜ ì´ë©”ì¼ì„ 5ë¶„ ì´ë‚´ì— ë°œì†¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ ì •ë„ ê·œëª¨ì˜ êµ¬ë…ìê°€ ìˆëŠ” ì„œë¹„ìŠ¤ë¼ë©´ ì¸í”„ë¼ë¥¼ ì´ë¯¸ ê°–ì¶”ê³  ìˆê³  ê°œë°œÂ·ìš´ì˜ ì¸ë ¥ì´ ì¶©ë¶„í•  ê²ƒìœ¼ë¡œ íŒë‹¨ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ëŸ° ê¸°ì—…ì´ë¼ë©´ ìì²´ì ìœ¼ë¡œ ì´ë©”ì¼ ë°œì†¡ ê¸°ëŠ¥ì„ ê°œë°œí•˜ëŠ” ê²ƒì´ ë‚«ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.

## ê¸°ìˆ  ì„ íƒ ì´ìœ 

### Lambda vs Fargate

|  | Lambda âœ… | Fargate |
| --- | --- | --- |
| ì„¤ëª… | AWSì˜ ì„œë²„ë¦¬ìŠ¤ ì»´í“¨íŒ… ì„œë¹„ìŠ¤ë¡œ, ì½”ë“œ ì‹¤í–‰ì— í•„ìš”í•œ ì¸í”„ë¼ë¥¼ ìë™ìœ¼ë¡œ ê´€ë¦¬ | ì»¨í…Œì´ë„ˆ ê¸°ë°˜ì˜ ì„œë²„ë¦¬ìŠ¤ ì»´í“¨íŒ… ì„œë¹„ìŠ¤ë¡œ, ECSì—ì„œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰ |
| ì¥ì  | ìë™ í™•ì¥, ê´€ë¦¬ê°€ í•„ìš” ì—†ëŠ” ì¸í”„ë¼, ë¹„ìš© íš¨ìœ¨ì  | ì»¨í…Œì´ë„ˆ ê¸°ë°˜ì˜ ìœ ì—°ì„±, ë‹¤ì–‘í•œ ì–¸ì–´ ë° í”„ë ˆì„ì›Œí¬ ì§€ì› |
| ë‹¨ì  | ì‹œì‘ ì§€ì—°(Lambda cold start), ìƒíƒœ ì €ì¥ì´ ì–´ë ¤ì›€ | ì´ˆê¸° ì„¤ì • ë³µì¡, ë¹„ìš©ì´ ë” ë†’ì„ ìˆ˜ ìˆìŒ |
- í´ë¼ìš°ë“œ ê¸°ë°˜, ì¸í”„ë¼ ì˜¤ë²„í—¤ë“œ ì ˆê°, ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‘ì€ êµ¬ì„± ìš”ì†Œë¡œ ë¶„í•´í•˜ì—¬ ë°°í¬í•˜ëŠ” ì ì—ì„œ ìœ ì‚¬
- ì´ë©”ì¼ì€ 24/7 ë™ì•ˆ ì§€ì†ì ìœ¼ë¡œ íŠ¸ë˜í”½ì´ ë°œìƒí•˜ì§€ ì•Šê³  ì „ì†¡ ì‹œê°„ì— ëœ ë¯¼ê°í•˜ê¸° ë•Œë¬¸ì— ì¸í”„ë¼ ê´€ë¦¬ ì§€ì ê³¼ ë¹„ìš©ì„ ì¤„ì´ê¸° ìœ„í•´ ì™„ì „ ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ì¸ Lambdaë¥¼ ì„ íƒí•˜ì˜€ìŠµë‹ˆë‹¤.
- **í•´ì»¤í†¤ì´ë¼ëŠ” íŠ¹ìˆ˜í•œ ìƒí™© ê³ ë ¤**

<aside>
ğŸ’¡ **Step Functionì„ ì‚¬ìš©í•˜ì§€ ì•Šì€ ì´ìœ **

Step Functionì€ ë‚´ë¶€ì˜ ìƒíƒœ ì „í™˜ì— ë”°ë¼ ë¹„ìš©ì´ ì²­êµ¬ë˜ëŠ”ë° Lambdaê°€ ì‹¤í–‰ë˜ëŠ” ëª¨ë“  ë¶€ë¶„ì´ ìƒíƒœ ì „í™˜ì´ë¼ `(ìš”ì²­ ìˆ˜)*(Lambda ê°œìˆ˜)` ë§Œí¼ì´ ë¹„ìš©ì´ ì²­êµ¬ë©ë‹ˆë‹¤. ì—¬ê¸°ì„œ Lambda ì‹¤í–‰ì— ëŒ€í•œ ìš”ê¸ˆì€ ë³„ê°œì´ë¯€ë¡œ Step Functionì„ ì‚¬ìš©í•˜ëŠ” ë§Œí¼ì˜ íš¨ìš©ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ í˜„ì¬ ì•„í‚¤í…ì²˜ëŠ” ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ì— ëŒ€í•œ ë¡œê¹… ë° ì¬ì „ì†¡ì„ SES ì´í›„ì˜ SNSê°€ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” í˜•íƒœì´ë¯€ë¡œ Step Functionì„ ì‚¬ìš©í•˜ì§€ ì•Šê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤. 

</aside>

### DynamoDBÂ vs RDS

|  | DynamoDB âœ… | RDS |
| --- | --- | --- |
| ì„¤ëª… | AWSì˜ ì™„ì „ ê´€ë¦¬í˜• NoSQL ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤ | AWSì˜ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤ |
| ì¥ì  | ìë™ í™•ì¥, ê³ ì„±ëŠ¥, ê´€ë¦¬ í•„ìš” ì—†ìŒ | SQL ì§€ì›, íŠ¸ëœì­ì…˜ ì²˜ë¦¬ |
| ë‹¨ì  | ë³µì¡í•œ ì¿¼ë¦¬ ì§€ì› ë¶€ì¡± | ìŠ¤ì¼€ì¼ë§ì— ì œí•œì´ ìˆì„ ìˆ˜ ìˆìŒ |
| ìºì‹œ | DAX | ElastiCache |
- ì´ ì‹œìŠ¤í…œì—ì„œ DBëŠ” ì´ë©”ì¼ í…œí”Œë¦¿ ì €ì¥ ìš©ë„ë¡œ ì“°ì…ë‹ˆë‹¤. ì €ì¥ë˜ëŠ” ì´ë©”ì¼ í…œí”Œë¦¿ì˜ í¬ê¸°ëŠ” 100KB ì´í•˜ì…ë‹ˆë‹¤. ì½ê¸°:ì“°ê¸° ë¹„ìœ¨ì´ 99:1ì´ë©° 24/7 ë™ì•ˆ ì§€ì†ì ìœ¼ë¡œ íŠ¸ë˜í”½ì´ ë°œìƒí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì¸ìŠ¤í„´ìŠ¤ ì‹¤í–‰ ì‹œê°„ ë‹¨ìœ„ë¡œ ë¹„ìš©ì„ ì‚°ì •í•˜ëŠ” RDSë³´ë‹¤ëŠ” ì‹¤ì œ ì‚¬ìš©í•œ ë°ì´í„° ì½ê¸° ë° ì“°ê¸°ì— ëŒ€í•´ì„œë§Œ ë¹„ìš©ì„ ì§€ë¶ˆí•˜ëŠ” DynamoDBë¥¼ ì„ íƒí•˜ì˜€ìŠµë‹ˆë‹¤.
